<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L√° S·ªë T·ª≠ Vi - Hi·ªÉn Th·ªã</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
        }
        .header h1 {
            font-size: 2.5em;
            margin: 0;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
        }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #495057;
            font-size: 0.9em;
        }
        .form-group input, .form-group select {
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin: 5px;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .result-section {
            background: #fff;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: none;
        }
        .result-section.show {
            display: block;
        }
        .cung-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .cung-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border-left: 5px solid #667eea;
            transition: transform 0.2s ease;
        }
        .cung-card:hover {
            transform: translateY(-3px);
        }
        .cung-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
        }
        .cung-info {
            display: grid;
            gap: 8px;
        }
        .cung-info div {
            padding: 8px;
            background: white;
            border-radius: 6px;
            border-left: 3px solid #667eea;
        }
        .cung-info strong {
            color: #495057;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #f5c6cb;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #c3e6cb;
            margin: 10px 0;
        }
        .download-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            margin-top: 20px;
        }
        .test-btn {
            background: linear-gradient(45deg, #ffc107, #fd7e14);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîÆ L√° S·ªë T·ª≠ Vi</h1>
            <p>T·∫°o v√† hi·ªÉn th·ªã l√° s·ªë t·ª≠ vi v·ªõi AI Gemini</p>
        </div>

        <div class="form-section">
            <h2>üìù Th√¥ng Tin C√° Nh√¢n</h2>
            <form id="lasoForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="user-name">H·ªç v√† T√™n:</label>
                        <input type="text" id="user-name" value="Ho√†ng Anh" required>
                    </div>
                    <div class="form-group">
                        <label for="user-gender">Gi·ªõi T√≠nh:</label>
                        <select id="user-gender" required>
                            <option value="Nam" selected>Nam</option>
                            <option value="N·ªØ">N·ªØ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="user-birthdate">Ng√†y Sinh (dd/mm/yy):</label>
                        <input type="text" id="user-birthdate" value="19/11/90" placeholder="dd/mm/yy" required>
                    </div>
                    <div class="form-group">
                        <label for="user-birthtime">Gi·ªù Sinh (24h):</label>
                        <input type="time" id="user-birthtime" value="08:30" required>
                    </div>
                    <div class="form-group">
                        <label for="user-birthplace">N∆°i Sinh:</label>
                        <input type="text" id="user-birthplace" value="H√† N·ªôi" required>
                    </div>
                </div>
                <div style="text-align: center;">
                    <button type="submit" class="btn">üéØ T·∫°o L√° S·ªë T·ª≠ Vi</button>
                    <button type="button" class="btn test-btn" onclick="testAPI()">üß™ Test API</button>
                    <button type="button" class="btn" onclick="generateMockData()">üé≤ D·ªØ Li·ªáu Gi·∫£</button>
                </div>
            </form>
        </div>

        <div id="message" style="display: none;"></div>

        <div id="result" class="result-section">
            <h2>üìä K·∫øt Qu·∫£ L√° S·ªë T·ª≠ Vi</h2>
            <div id="loading" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>ƒêang t·∫°o l√° s·ªë t·ª≠ vi...</p>
            </div>
            <div id="content"></div>
            <button class="btn download-btn" onclick="downloadMarkdown()" style="display: none;">üì• T·∫£i Xu·ªëng MD</button>
        </div>
    </div>

    <script>
        // API Keys
        const API_KEYS = [
            'AIzaSyAlst5yeNQebSyfxUMRY6yDK7lvwKMUzLM',
            'AIzaSyCnj2qJX2fX2AjGRMLzXI5kFak8-SdTe6Q',
            'AIzaSyAxs5Y8I2wBENa3ZaE45iK5jxdvWpn-Pjs'
        ];

        // Models
        const GEMINI_MODELS = [
            'gemini-2.5-pro',
            'gemini-2.5-flash',
            'gemini-2.5-flash-lite',
            'gemini-1.5-pro',
            'gemini-1.5-flash',
            'gemini-pro'
        ];

        let currentKeyIndex = 0;
        let currentData = null;

        // Validate date format
        function validateDateFormat(dateString) {
            const dateRegex = /^(\d{1,2})\/(\d{1,2})\/(\d{2})$/;
            const match = dateString.match(dateRegex);
            
            if (!match) return false;
            
            const day = parseInt(match[1]);
            const month = parseInt(match[2]);
            const year = parseInt(match[3]);
            const fullYear = year < 50 ? 2000 + year : 1900 + year;
            
            const date = new Date(fullYear, month - 1, day);
            return date.getDate() === day && 
                   date.getMonth() === month - 1 && 
                   date.getFullYear() === fullYear;
        }

        // Convert date format
        function convertDateFormat(dateString) {
            const dateRegex = /^(\d{1,2})\/(\d{1,2})\/(\d{2})$/;
            const match = dateString.match(dateRegex);
            
            if (!match) return null;
            
            const day = match[1].padStart(2, '0');
            const month = match[2].padStart(2, '0');
            const year = parseInt(match[3]);
            const fullYear = year < 50 ? 2000 + year : 1900 + year;
            
            return `${fullYear}-${month}-${day}`;
        }

        // Show message
        function showMessage(message, type = 'info') {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = message;
            messageDiv.className = type;
            messageDiv.style.display = 'block';
            
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }

        // Validate Markdown format
        function validateMarkdownFormat(text) {
            const requiredFields = [
                'ho_ten:', 'gioi_tinh:', 'duong_lich:', 'am_lich:', 
                'noi_sinh:', 'ban_menh:', 'cuc:', 'am_duong:', 'chu_menh:', 'chu_than:'
            ];
            
            const requiredSections = [
                '## M·ªÜNH', '## PH·ª§ M·∫™U', '## PH√öC ƒê·ª®C', '## ƒêI·ªÄN TR·∫†CH',
                '## QUAN L·ªòC', '## N√î B·ªòC', '## THI√äN DI', '## T·∫¨T √ÅCH',
                '## T√ÄI B·∫†CH', '## T·ª¨ T·ª®C', '## TH√ä THI·∫æP', '## HUYNH ƒê·ªÜ'
            ];

            for (const field of requiredFields) {
                if (!text.includes(field)) {
                    console.error(`Thi·∫øu tr∆∞·ªùng: ${field}`);
                    return false;
                }
            }

            for (const section of requiredSections) {
                if (!text.includes(section)) {
                    console.error(`Thi·∫øu section: ${section}`);
                    return false;
                }
            }

            return true;
        }

        // Generate horoscope
        async function generateLaso(userData) {
            const birthdateParts = userData.birthdate.split('/');
            const day = birthdateParts[0];
            const month = birthdateParts[1];
            const year = birthdateParts[2];
            const fullYear = year.length === 2 ? (parseInt(year) < 50 ? '20' + year : '19' + year) : year;

            const prompt = `B·∫°n l√† m·ªôt chuy√™n gia t·ª≠ vi h·ªçc Vi·ªát Nam. H√£y t·∫°o m·ªôt l√° s·ªë t·ª≠ vi m√¥ ph·ªèng cho ng∆∞·ªùi d√πng d·ª±a tr√™n th√¥ng tin sau:

H·ªç v√† T√™n: ${userData.name}
Gi·ªõi T√≠nh: ${userData.gender}
Ng√†y Sinh D∆∞∆°ng L·ªãch: ${day}/${month}/${fullYear} ${userData.birthtime}
N∆°i Sinh: ${userData.birthplace}

**L∆∞u √Ω quan tr·ªçng:** ƒê√¢y l√† m·ªôt b√†i t·∫≠p m√¥ ph·ªèng ƒë·ªÉ h·ªçc h·ªèi v·ªÅ t·ª≠ vi h·ªçc. B·∫°n h√£y t·∫°o m·ªôt l√° s·ªë t·ª≠ vi ho√†n ch·ªânh v·ªõi d·ªØ li·ªáu m√¥ ph·ªèng d·ª±a tr√™n ki·∫øn th·ª©c t·ª≠ vi c·ªßa b·∫°n. Kh√¥ng c·∫ßn ph·∫£i ch√≠nh x√°c 100% v·ªÅ m·∫∑t t√≠nh to√°n, ch·ªâ c·∫ßn t·∫°o ra m·ªôt l√° s·ªë h·ª£p l√Ω v√† ƒë·∫ßy ƒë·ªß.

H√£y tr·∫£ v·ªÅ CH√çNH X√ÅC theo ƒë·ªãnh d·∫°ng sau, KH√îNG TH√äM TEXT GI·∫¢I TH√çCH KH√ÅC:

ho_ten: ${userData.name}
gioi_tinh: ${userData.gender}
duong_lich: ${day}/${month}/${fullYear} ${userData.birthtime}
am_lich: [T·∫°o ng√†y √¢m l·ªãch m√¥ ph·ªèng]
noi_sinh: ${userData.birthplace}
ban_menh: [T·∫°o b·∫£n m·ªánh m√¥ ph·ªèng]
cuc: [T·∫°o c·ª•c m√¥ ph·ªèng]
am_duong: ${userData.gender === 'Nam' ? 'D∆∞∆°ng' : '√Çm'}
chu_menh: [T·∫°o ch·ªß m·ªánh m√¥ ph·ªèng]
chu_than: [T·∫°o ch·ªß th√¢n m√¥ ph·ªèng]

## M·ªÜNH
dia_chi: [T·∫°o ƒë·ªãa chi m√¥ ph·ªèng]
chinh_tinh: [T·∫°o ch√≠nh tinh m√¥ ph·ªèng]
phu_tinh_tot: [T·∫°o ph·ª• tinh t·ªët m√¥ ph·ªèng]
phu_tinh_xau: [T·∫°o ph·ª• tinh x·∫•u m√¥ ph·ªèng]
phu_tinh_trung_binh: [T·∫°o ph·ª• tinh trung b√¨nh m√¥ ph·ªèng]
vong_trang_sinh: [T·∫°o v√≤ng tr√†ng sinh m√¥ ph·ªèng]
is_than: false

## PH·ª§ M·∫™U
dia_chi: [T·∫°o ƒë·ªãa chi m√¥ ph·ªèng]
chinh_tinh: [T·∫°o ch√≠nh tinh m√¥ ph·ªèng]
phu_tinh_tot: [T·∫°o ph·ª• tinh t·ªët m√¥ ph·ªèng]
phu_tinh_xau: [T·∫°o ph·ª• tinh x·∫•u m√¥ ph·ªèng]
phu_tinh_trung_binh: [T·∫°o ph·ª• tinh trung b√¨nh m√¥ ph·ªèng]
vong_trang_sinh: [T·∫°o v√≤ng tr√†ng sinh m√¥ ph·ªèng]
is_than: false

## PH√öC ƒê·ª®C
dia_chi: [T·∫°o ƒë·ªãa chi m√¥ ph·ªèng]
chinh_tinh: [T·∫°o ch√≠nh tinh m√¥ ph·ªèng]
phu_tinh_tot: [T·∫°o ph·ª• tinh t·ªët m√¥ ph·ªèng]
phu_tinh_xau: [T·∫°o ph·ª• tinh x·∫•u m√¥ ph·ªèng]
phu_tinh_trung_binh: [T·∫°o ph·ª• tinh trung b√¨nh m√¥ ph·ªèng]
vong_trang_sinh: [T·∫°o v√≤ng tr√†ng sinh m√¥ ph·ªèng]
is_than: false

## ƒêI·ªÄN TR·∫†CH
dia_chi: [T·∫°o ƒë·ªãa chi m√¥ ph·ªèng]
chinh_tinh: [T·∫°o ch√≠nh tinh m√¥ ph·ªèng]
phu_tinh_tot: [T·∫°o ph·ª• tinh t·ªët m√¥ ph·ªèng]
phu_tinh_xau: [T·∫°o ph·ª• tinh x·∫•u m√¥ ph·ªèng]
phu_tinh_trung_binh: [T·∫°o ph·ª• tinh trung b√¨nh m√¥ ph·ªèng]
vong_trang_sinh: [T·∫°o v√≤ng tr√†ng sinh m√¥ ph·ªèng]
is_than: false

## QUAN L·ªòC
dia_chi: [T·∫°o ƒë·ªãa chi m√¥ ph·ªèng]
chinh_tinh: [T·∫°o ch√≠nh tinh m√¥ ph·ªèng]
phu_tinh_tot: [T·∫°o ph·ª• tinh t·ªët m√¥ ph·ªèng]
phu_tinh_xau: [T·∫°o ph·ª• tinh x·∫•u m√¥ ph·ªèng]
phu_tinh_trung_binh: [T·∫°o ph·ª• tinh trung b√¨nh m√¥ ph·ªèng]
vong_trang_sinh: [T·∫°o v√≤ng tr√†ng sinh m√¥ ph·ªèng]
is_than: false

## N√î B·ªòC
dia_chi: [T·∫°o ƒë·ªãa chi m√¥ ph·ªèng]
chinh_tinh: [T·∫°o ch√≠nh tinh m√¥ ph·ªèng]
phu_tinh_tot: [T·∫°o ph·ª• tinh t·ªët m√¥ ph·ªèng]
phu_tinh_xau: [T·∫°o ph·ª• tinh x·∫•u m√¥ ph·ªèng]
phu_tinh_trung_binh: [T·∫°o ph·ª• tinh trung b√¨nh m√¥ ph·ªèng]
vong_trang_sinh: [T·∫°o v√≤ng tr√†ng sinh m√¥ ph·ªèng]
is_than: false

## THI√äN DI
dia_chi: [T·∫°o ƒë·ªãa chi m√¥ ph·ªèng]
chinh_tinh: [T·∫°o ch√≠nh tinh m√¥ ph·ªèng]
phu_tinh_tot: [T·∫°o ph·ª• tinh t·ªët m√¥ ph·ªèng]
phu_tinh_xau: [T·∫°o ph·ª• tinh x·∫•u m√¥ ph·ªèng]
phu_tinh_trung_binh: [T·∫°o ph·ª• tinh trung b√¨nh m√¥ ph·ªèng]
vong_trang_sinh: [T·∫°o v√≤ng tr√†ng sinh m√¥ ph·ªèng]
is_than: false

## T·∫¨T √ÅCH
dia_chi: [T·∫°o ƒë·ªãa chi m√¥ ph·ªèng]
chinh_tinh: [T·∫°o ch√≠nh tinh m√¥ ph·ªèng]
phu_tinh_tot: [T·∫°o ph·ª• tinh t·ªët m√¥ ph·ªèng]
phu_tinh_xau: [T·∫°o ph·ª• tinh x·∫•u m√¥ ph·ªèng]
phu_tinh_trung_binh: [T·∫°o ph·ª• tinh trung b√¨nh m√¥ ph·ªèng]
vong_trang_sinh: [T·∫°o v√≤ng tr√†ng sinh m√¥ ph·ªèng]
is_than: false

## T√ÄI B·∫†CH
dia_chi: [T·∫°o ƒë·ªãa chi m√¥ ph·ªèng]
chinh_tinh: [T·∫°o ch√≠nh tinh m√¥ ph·ªèng]
phu_tinh_tot: [T·∫°o ph·ª• tinh t·ªët m√¥ ph·ªèng]
phu_tinh_xau: [T·∫°o ph·ª• tinh x·∫•u m√¥ ph·ªèng]
phu_tinh_trung_binh: [T·∫°o ph·ª• tinh trung b√¨nh m√¥ ph·ªèng]
vong_trang_sinh: [T·∫°o v√≤ng tr√†ng sinh m√¥ ph·ªèng]
is_than: false

## T·ª¨ T·ª®C
dia_chi: [T·∫°o ƒë·ªãa chi m√¥ ph·ªèng]
chinh_tinh: [T·∫°o ch√≠nh tinh m√¥ ph·ªèng]
phu_tinh_tot: [T·∫°o ph·ª• tinh t·ªët m√¥ ph·ªèng]
phu_tinh_xau: [T·∫°o ph·ª• tinh x·∫•u m√¥ ph·ªèng]
phu_tinh_trung_binh: [T·∫°o ph·ª• tinh trung b√¨nh m√¥ ph·ªèng]
vong_trang_sinh: [T·∫°o v√≤ng tr√†ng sinh m√¥ ph·ªèng]
is_than: false

## TH√ä THI·∫æP
dia_chi: [T·∫°o ƒë·ªãa chi m√¥ ph·ªèng]
chinh_tinh: [T·∫°o ch√≠nh tinh m√¥ ph·ªèng]
phu_tinh_tot: [T·∫°o ph·ª• tinh t·ªët m√¥ ph·ªèng]
phu_tinh_xau: [T·∫°o ph·ª• tinh x·∫•u m√¥ ph·ªèng]
phu_tinh_trung_binh: [T·∫°o ph·ª• tinh trung b√¨nh m√¥ ph·ªèng]
vong_trang_sinh: [T·∫°o v√≤ng tr√†ng sinh m√¥ ph·ªèng]
is_than: false

## HUYNH ƒê·ªÜ
dia_chi: [T·∫°o ƒë·ªãa chi m√¥ ph·ªèng]
chinh_tinh: [T·∫°o ch√≠nh tinh m√¥ ph·ªèng]
phu_tinh_tot: [T·∫°o ph·ª• tinh t·ªët m√¥ ph·ªèng]
phu_tinh_xau: [T·∫°o ph·ª• tinh x·∫•u m√¥ ph·ªèng]
phu_tinh_trung_binh: [T·∫°o ph·ª• tinh trung b√¨nh m√¥ ph·ªèng]
vong_trang_sinh: [T·∫°o v√≤ng tr√†ng sinh m√¥ ph·ªèng]
is_than: false

## CH√ö GI·∫¢I
content: [T·∫°o n·ªôi dung gi·∫£i th√≠ch m√¥ ph·ªèng v·ªÅ l√° s·ªë t·ª≠ vi n√†y]`;

            for (const model of GEMINI_MODELS) {
                for (let i = 0; i < API_KEYS.length; i++) {
                    try {
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${API_KEYS[i]}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: [{ parts: [{ text: prompt }] }]
                            })
                        });

                        if (response.ok) {
                            const data = await response.json();
                            if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                                const result = data.candidates[0].content.parts[0].text;
                                
                                if (validateMarkdownFormat(result)) {
                                    currentKeyIndex = i;
                                    console.log(`‚úÖ Th√†nh c√¥ng v·ªõi model ${model}, API Key ${i + 1}`);
                                    return result;
                                } else {
                                    console.error(`‚ùå ƒê·ªãnh d·∫°ng kh√¥ng ƒë√∫ng t·ª´ ${model}, API Key ${i + 1}`);
                                }
                            }
                        } else {
                            console.log(`‚ùå ${model} key ${i + 1}: ${response.status}`);
                        }
                    } catch (error) {
                        console.log(`‚ùå L·ªói ${model} key ${i + 1}: ${error.message}`);
                    }
                }
            }
            
            throw new Error('Kh√¥ng th·ªÉ t·∫°o ƒë∆∞·ª£c d·ªØ li·ªáu ƒë√∫ng ƒë·ªãnh d·∫°ng. Vui l√≤ng th·ª≠ l·∫°i.');
        }

        // Parse Markdown data
        function parseMarkdownData(md) {
            const data = { cung: {}, chu_giai: [] };
            
            const generalInfoLines = md.split('## ')[0].split('\n');
            generalInfoLines.forEach(line => {
                if (line.trim()) {
                    const [key, ...valueParts] = line.split(':');
                    if (key && key.trim()) {
                        data[key.trim()] = valueParts.join(':').trim();
                    }
                }
            });
            
            const cungSections = md.split('## ').slice(1);
            cungSections.forEach(section => {
                const lines = section.split('\n');
                const titleLine = lines[0].trim();
                
                if (titleLine === 'CH√ö GI·∫¢I') {
                    const content = lines.slice(1).join('\n').trim();
                    data.chu_giai = content;
                } else {
                    const cungData = {};
                    lines.slice(1).forEach(line => {
                        if (line.trim()) {
                            const [key, ...valueParts] = line.split(':');
                            if (key && key.trim()) {
                                cungData[key.trim()] = valueParts.join(':').trim();
                            }
                        }
                    });
                    data.cung[titleLine] = cungData;
                }
            });
            
            return data;
        }

        // Display data
        function displayData(data) {
            const contentDiv = document.getElementById('content');
            let html = `
                <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3>üë§ Th√¥ng Tin C√° Nh√¢n</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                        <div><strong>H·ªç v√† T√™n:</strong> ${data.ho_ten || 'N/A'}</div>
                        <div><strong>Gi·ªõi T√≠nh:</strong> ${data.gioi_tinh || 'N/A'}</div>
                        <div><strong>D∆∞∆°ng L·ªãch:</strong> ${data.duong_lich || 'N/A'}</div>
                        <div><strong>√Çm L·ªãch:</strong> ${data.am_lich || 'N/A'}</div>
                        <div><strong>N∆°i Sinh:</strong> ${data.noi_sinh || 'N/A'}</div>
                        <div><strong>B·∫£n M·ªánh:</strong> ${data.ban_menh || 'N/A'}</div>
                        <div><strong>C·ª•c:</strong> ${data.cuc || 'N/A'}</div>
                        <div><strong>√Çm D∆∞∆°ng:</strong> ${data.am_duong || 'N/A'}</div>
                        <div><strong>Ch·ªß M·ªánh:</strong> ${data.chu_menh || 'N/A'}</div>
                        <div><strong>Ch·ªß Th√¢n:</strong> ${data.chu_than || 'N/A'}</div>
                    </div>
                </div>
            `;

            html += '<div class="cung-grid">';
            
            const cungNames = {
                'M·ªÜNH': 'M·ªánh',
                'PH·ª§ M·∫™U': 'Ph·ª• M·∫´u',
                'PH√öC ƒê·ª®C': 'Ph√∫c ƒê·ª©c',
                'ƒêI·ªÄN TR·∫†CH': 'ƒêi·ªÅn Tr·∫°ch',
                'QUAN L·ªòC': 'Quan L·ªôc',
                'N√î B·ªòC': 'N√¥ B·ªôc',
                'THI√äN DI': 'Thi√™n Di',
                'T·∫¨T √ÅCH': 'T·∫≠t √Åch',
                'T√ÄI B·∫†CH': 'T√†i B·∫°ch',
                'T·ª¨ T·ª®C': 'T·ª≠ T·ª©c',
                'TH√ä THI·∫æP': 'Th√™ Thi·∫øp',
                'HUYNH ƒê·ªÜ': 'Huynh ƒê·ªá'
            };

            Object.keys(cungNames).forEach(cungKey => {
                const cungData = data.cung[cungKey];
                if (cungData) {
                    html += `
                        <div class="cung-card">
                            <div class="cung-title">${cungNames[cungKey]}</div>
                            <div class="cung-info">
                                <div><strong>ƒê·ªãa Chi:</strong> ${cungData.dia_chi || 'N/A'}</div>
                                <div><strong>Ch√≠nh Tinh:</strong> ${cungData.chinh_tinh || 'N/A'}</div>
                                <div><strong>Ph·ª• Tinh T·ªët:</strong> ${cungData.phu_tinh_tot || 'N/A'}</div>
                                <div><strong>Ph·ª• Tinh X·∫•u:</strong> ${cungData.phu_tinh_xau || 'N/A'}</div>
                                <div><strong>Ph·ª• Tinh Trung B√¨nh:</strong> ${cungData.phu_tinh_trung_binh || 'N/A'}</div>
                                <div><strong>V√≤ng Tr√†ng Sinh:</strong> ${cungData.vong_trang_sinh || 'N/A'}</div>
                                <div><strong>L√† Th√¢n:</strong> ${cungData.is_than || 'N/A'}</div>
                            </div>
                        </div>
                    `;
                }
            });

            html += '</div>';

            if (data.chu_giai && data.chu_giai.length > 0) {
                html += `
                    <div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin-top: 20px;">
                        <h3>üìù Ch√∫ Gi·∫£i</h3>
                        <p>${data.chu_giai}</p>
                    </div>
                `;
            }

            contentDiv.innerHTML = html;
            document.querySelector('.download-btn').style.display = 'inline-block';
        }

        // Download Markdown
        function downloadMarkdown() {
            if (!currentData) return;
            
            const timestamp = new Date().toLocaleString('vi-VN');
            const header = `# L√Å S·ªê T·ª¨ VI - ${currentData.ho_ten || 'Kh√¥ng x√°c ƒë·ªãnh'}

**Ng√†y t·∫°o:** ${timestamp}

---

`;
            
            const content = header + currentData.rawMarkdown;
            const blob = new Blob([content], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `laso_tuvi_${Date.now()}.md`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Generate mock data
        function generateMockData() {
            const userData = {
                name: document.getElementById('user-name').value,
                gender: document.getElementById('user-gender').value,
                birthdate: document.getElementById('user-birthdate').value,
                birthtime: document.getElementById('user-birthtime').value,
                birthplace: document.getElementById('user-birthplace').value
            };

            const birthdateParts = userData.birthdate.split('/');
            const day = birthdateParts[0];
            const month = birthdateParts[1];
            const year = birthdateParts[2];
            const fullYear = year.length === 2 ? (parseInt(year) < 50 ? '20' + year : '19' + year) : year;

            const mockData = `ho_ten: ${userData.name}
gioi_tinh: ${userData.gender}
duong_lich: ${day}/${month}/${fullYear} ${userData.birthtime}
am_lich: 01/10/Canh Ng·ªç
noi_sinh: ${userData.birthplace}
ban_menh: Th·ªï - L·ªô B√†ng Th·ªï
cuc: Th·ªï c·ª•c 5
am_duong: ${userData.gender === 'Nam' ? 'D∆∞∆°ng' : '√Çm'}
chu_menh: T·ª≠ Vi
chu_than: Thi√™n C∆°

## M·ªÜNH
dia_chi: Ng·ªç
chinh_tinh: T·ª≠ Vi (V)
phu_tinh_tot: Thi√™n Kh√¥i, Hoa Quy·ªÅn
phu_tinh_xau: K√¨nh D∆∞∆°ng
phu_tinh_trung_binh: Tam ƒê√†i, B√°t T·ªça
vong_trang_sinh: Quan ƒê·ªõi
is_than: false

## PH·ª§ M·∫™U
dia_chi: M√πi
chinh_tinh: Thi√™n C∆° (M)
phu_tinh_tot: VƒÉn X∆∞∆°ng, Thi√™n Qu√Ω
phu_tinh_xau: ƒê√† La
phu_tinh_trung_binh: Thi√™n Ph√∫c, Thi√™n Quan
vong_trang_sinh: L√¢m Quan
is_than: false

## PH√öC ƒê·ª®C
dia_chi: Th√¢n
chinh_tinh: Th√°i D∆∞∆°ng (ƒê)
phu_tinh_tot: Thi√™n T∆∞·ªõng
phu_tinh_xau: H·ªèa Tinh
phu_tinh_trung_binh: Thi√™n H√¨nh, Gi·∫£i Th·∫ßn
vong_trang_sinh: ƒê·∫ø V∆∞·ª£ng
is_than: false

## ƒêI·ªÄN TR·∫†CH
dia_chi: D·∫≠u
chinh_tinh: V≈© Kh√∫c (H)
phu_tinh_tot: VƒÉn Kh√∫c, Thi√™n Ph√∫c
phu_tinh_xau: Linh Tinh
phu_tinh_trung_binh: Thi√™n Kh√¥ng, ƒê·ªãa Ki·∫øp
vong_trang_sinh: Suy
is_than: false

## QUAN L·ªòC
dia_chi: Tu·∫•t
chinh_tinh: Thi√™n ƒê·ªìng (V)
phu_tinh_tot: T·∫£ Ph·ª•, H·ªØu B·∫≠t
phu_tinh_xau: Tu·∫ßn Kh√¥ng
phu_tinh_trung_binh: Thi√™n M√£, ƒê·ªãa Ki·∫øp
vong_trang_sinh: B·ªánh
is_than: false

## N√î B·ªòC
dia_chi: H·ª£i
chinh_tinh: Li√™m Trinh (M)
phu_tinh_tot: Thi√™n Quan, Ph∆∞·ªõc ƒê·ª©c
phu_tinh_xau: B√°c Sƒ©
phu_tinh_trung_binh: Thi√™n L∆∞∆°ng, Thi√™n T√†i
vong_trang_sinh: T·ª≠
is_than: false

## THI√äN DI
dia_chi: T√Ω
chinh_tinh: Tham Lang (ƒê)
phu_tinh_tot: Thi√™n H∆∞, Thi√™n Qu√Ω
phu_tinh_xau: Thi√™n H√¨nh
phu_tinh_trung_binh: Thi√™n Kh√¥ng, ƒê·ªãa Ki·∫øp
vong_trang_sinh: M·ªô
is_than: false

## T·∫¨T √ÅCH
dia_chi: S·ª≠u
chinh_tinh: C·ª± M√¥n (V)
phu_tinh_tot: Thi√™n T∆∞·ªõng, Thi√™n Qu√Ω
phu_tinh_xau: Thi√™n H√¨nh
phu_tinh_trung_binh: Thi√™n Kh√¥ng, ƒê·ªãa Ki·∫øp
vong_trang_sinh: Tuy·ªát
is_than: false

## T√ÄI B·∫†CH
dia_chi: D·∫ßn
chinh_tinh: Thi√™n T∆∞·ªõng (M)
phu_tinh_tot: Thi√™n Quan, Ph∆∞·ªõc ƒê·ª©c
phu_tinh_xau: B√°c Sƒ©
phu_tinh_trung_binh: Thi√™n L∆∞∆°ng, Thi√™n T√†i
vong_trang_sinh: Thai
is_than: false

## T·ª¨ T·ª®C
dia_chi: M√£o
chinh_tinh: Thi√™n L∆∞∆°ng (ƒê)
phu_tinh_tot: Thi√™n H∆∞, Thi√™n Qu√Ω
phu_tinh_xau: Thi√™n H√¨nh
phu_tinh_trung_binh: Thi√™n Kh√¥ng, ƒê·ªãa Ki·∫øp
vong_trang_sinh: D∆∞·ª°ng
is_than: false

## TH√ä THI·∫æP
dia_chi: Th√¨n
chinh_tinh: Th·∫•t S√°t (V)
phu_tinh_tot: Thi√™n T∆∞·ªõng, Thi√™n Qu√Ω
phu_tinh_xau: Thi√™n H√¨nh
phu_tinh_trung_binh: Thi√™n Kh√¥ng, ƒê·ªãa Ki·∫øp
vong_trang_sinh: Tr∆∞·ªùng Sinh
is_than: false

## HUYNH ƒê·ªÜ
dia_chi: T·ªµ
chinh_tinh: Ph√° Qu√¢n (M)
phu_tinh_tot: Thi√™n Quan, Ph∆∞·ªõc ƒê·ª©c
phu_tinh_xau: B√°c Sƒ©
phu_tinh_trung_binh: Thi√™n L∆∞∆°ng, Thi√™n T√†i
vong_trang_sinh: M·ªôc D·ª•c
is_than: false

## CH√ö GI·∫¢I
content: ƒê√¢y l√† l√° s·ªë t·ª≠ vi m√¥ ph·ªèng cho ${userData.name}, sinh ng√†y ${day}/${month}/${fullYear} ${userData.birthtime} t·∫°i ${userData.birthplace}. L√° s·ªë n√†y ƒë∆∞·ª£c t·∫°o ra ƒë·ªÉ h·ªçc h·ªèi v√† nghi√™n c·ª©u v·ªÅ t·ª≠ vi h·ªçc Vi·ªát Nam.`;

            currentData = {
                rawMarkdown: mockData,
                ...parseMarkdownData(mockData)
            };

            document.getElementById('result').classList.add('show');
            document.getElementById('loading').style.display = 'none';
            displayData(currentData);
            showMessage('‚úÖ ƒê√£ t·∫°o d·ªØ li·ªáu gi·∫£ th√†nh c√¥ng!', 'success');
        }

        // Test API
        async function testAPI() {
            showMessage('üß™ ƒêang test API...', 'info');
            
            for (const model of GEMINI_MODELS) {
                for (let i = 0; i < API_KEYS.length; i++) {
                    try {
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${API_KEYS[i]}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: [{ parts: [{ text: 'Xin ch√†o, h√£y tr·∫£ l·ªùi "OK" n·∫øu b·∫°n ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng.' }] }]
                            })
                        });

                        if (response.ok) {
                            const data = await response.json();
                            if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                                const result = data.candidates[0].content.parts[0].text;
                                showMessage(`‚úÖ API ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng v·ªõi model ${model}!`, 'success');
                                return;
                            }
                        }
                    } catch (error) {
                        console.log(`‚ùå L·ªói ${model} key ${i + 1}: ${error.message}`);
                    }
                }
            }
            
            showMessage('‚ùå Kh√¥ng th·ªÉ k·∫øt n·ªëi v·ªõi API. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi m·∫°ng v√† API key.', 'error');
        }

        // Form submit
        document.getElementById('lasoForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const userData = {
                name: document.getElementById('user-name').value,
                gender: document.getElementById('user-gender').value,
                birthdate: document.getElementById('user-birthdate').value,
                birthtime: document.getElementById('user-birthtime').value,
                birthplace: document.getElementById('user-birthplace').value
            };

            if (!validateDateFormat(userData.birthdate)) {
                showMessage('‚ùå ƒê·ªãnh d·∫°ng ng√†y sinh kh√¥ng ƒë√∫ng. Vui l√≤ng s·ª≠ d·ª•ng dd/mm/yy', 'error');
                return;
            }

            document.getElementById('result').classList.add('show');
            document.getElementById('loading').style.display = 'block';
            document.querySelector('.download-btn').style.display = 'none';

            try {
                const result = await generateLaso(userData);
                currentData = {
                    rawMarkdown: result,
                    ...parseMarkdownData(result)
                };
                
                document.getElementById('loading').style.display = 'none';
                displayData(currentData);
                showMessage('‚úÖ ƒê√£ t·∫°o l√° s·ªë t·ª≠ vi th√†nh c√¥ng!', 'success');
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                showMessage(`‚ùå L·ªói: ${error.message}`, 'error');
            }
        });
    </script>
</body>
</html>
