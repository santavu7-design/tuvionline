<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biểu Đồ Tử Vi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            line-height: 1.4;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: #7f8c8d;
            font-size: 1.2em;
        }

        .tuvi-chart {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            grid-template-rows: 1fr 1fr 1fr 1fr;
            gap: 3px;
            background: #e8e8e8;
            padding: 3px;
            border-radius: 8px;
            margin-bottom: 30px;
            min-height: 900px;
        }

        .palace {
            background: #fafafa;
            border: 1px solid #ddd;
            padding: 12px;
            border-radius: 6px;
            position: relative;
            font-size: 0.9em;
        }

        .palace-coordinates {
            position: absolute;
            top: 5px;
            left: 8px;
            font-size: 0.8em;
            color: #666;
            font-weight: bold;
        }

        .palace-age {
            position: absolute;
            top: 5px;
            right: 8px;
            font-size: 0.8em;
            color: #666;
            font-weight: bold;
        }

        .palace-name {
            font-size: 1.1em;
            font-weight: bold;
            color: #2c3e50;
            text-align: center;
            margin: 20px 0 8px 0;
            text-transform: uppercase;
        }

        .star {
            display: inline-block;
            margin: 2px 4px 2px 0;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .star.weak { 
            background: #e74c3c; 
            color: white; 
        }
        .star.strong { 
            background: #27ae60; 
            color: white; 
        }
        .star.average { 
            background: #f39c12; 
            color: white; 
        }
        .star.neutral { 
            background: #f39c12; 
            color: white; 
        }
        .star.auxiliary { 
            background: #3498db; 
            color: white; 
        }

        .special-box {
            background: #e74c3c;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
            display: inline-block;
            margin: 4px 0;
        }

        .palace-bottom {
            position: absolute;
            bottom: 8px;
            left: 8px;
            right: 8px;
            font-size: 0.8em;
            color: #666;
            text-align: center;
        }

        .central-info {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            color: #333;
            padding: 20px;
            border-radius: 8px;
            grid-column: 2 / 4;
            grid-row: 2 / 4;
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            justify-content: center;
            border: 2px solid #8B4513;
            text-align: center;
        }

        .central-info h3 {
            color: #8B4513;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .central-info .info-row {
            display: flex;
            justify-content: space-between;
            margin: 4px 0;
            padding: 2px 0;
        }

        .central-info .info-label {
            font-weight: bold;
            color: #555;
        }

        .central-info .info-value {
            color: #333;
        }

        .central-info .info-value.red {
            color: #e74c3c;
            font-weight: bold;
        }

        .color-legend {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        .legend-color.kim { background: #000; }
        .legend-color.thuy { background: #3498db; }
        .legend-color.moc { background: #27ae60; }
        .legend-color.hoa { background: #e74c3c; }
        .legend-color.tho { background: #f39c12; }

        .legend-text {
            text-align: center;
            margin-top: 15px;
            color: #666;
            font-size: 0.9em;
        }

        /* Palace positioning */
        .palace:nth-child(1) { grid-column: 1; grid-row: 1; } /* MỆNH */
        .palace:nth-child(2) { grid-column: 2; grid-row: 1; } /* PHỤ MẪU */
        .palace:nth-child(3) { grid-column: 3; grid-row: 1; } /* PHÚC ĐỨC */
        .palace:nth-child(4) { grid-column: 4; grid-row: 1; } /* ĐIỀN TRẠCH */
        .palace:nth-child(5) { grid-column: 4; grid-row: 2; } /* SỰ NGHIỆP */
        .palace:nth-child(6) { grid-column: 4; grid-row: 3; } /* GIAO HỮU */
        .palace:nth-child(7) { grid-column: 4; grid-row: 4; } /* THIÊN DI */
        .palace:nth-child(8) { grid-column: 3; grid-row: 4; } /* TẬT ÁCH */
        .palace:nth-child(9) { grid-column: 2; grid-row: 4; } /* TÀI BẠCH */
        .palace:nth-child(10) { grid-column: 1; grid-row: 4; } /* TỪ NỮ */
        .palace:nth-child(11) { grid-column: 1; grid-row: 3; } /* PHU THÊ */
        .palace:nth-child(12) { grid-column: 1; grid-row: 2; } /* HUYNH ĐỆ */
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>BIỂU ĐỒ TỬ VI</h1>
            <div class="subtitle">Biểu đồ tử vi theo 12 cung</div>
        </div>

        <div class="tuvi-chart">
            <!-- MỆNH -->
            <div class="palace">
                <div class="palace-coordinates">A. Tý</div>
                <div class="palace-age">1-10</div>
                <div class="palace-name">MỆNH</div>
                <div class="star weak">THÁI ÂM (H)</div>
                <div>Đài phu, <span class="star average">Hòa lộc (B)</span>, Thiên trú</div>
                <div>Bạch hổ, Quan phủ, <span class="star strong">Lộc tồn (V)</span></div>
                <div><span class="star weak">Đà la (H)</span>, Bác sĩ</div>
                <div><span class="star weak">Phá toái (H)</span>, Tả phủ</div>
                <div>Chỉ bối, <span class="star strong">Thiên đức (V)</span></div>
                <div class="special-box">Tuần không</div>
                <div><span class="star weak">Hàm trì (H)</span>, <span class="star strong">Hồng loan (V)</span>, Đầu quân</div>
                <div class="palace-bottom">Hợi, Lâm quan, -HÒA Tuất</div>
            </div>

            <!-- PHỤ MẪU -->
            <div class="palace">
                <div class="palace-coordinates">6 B. Ngọ</div>
                <div class="palace-age">11-20</div>
                <div class="palace-name">PHỤ MẪU</div>
                <div class="star strong">THAM LANG (V)</div>
                <div class="palace-bottom">Để vượng, +HÒA Dậu</div>
            </div>

            <!-- PHÚC ĐỨC -->
            <div class="palace">
                <div class="palace-coordinates">16 Đ. Mùi</div>
                <div class="palace-age">21-30</div>
                <div class="palace-name">PHÚC ĐỨC</div>
                <div class="star weak">THIÊN ĐỒNG (H)</div>
                <div class="star weak">CỰ MÔN (H)</div>
                <div>Lực sĩ, <span class="star strong">Hóa quyền (V)</span></div>
                <div>Điều khách, <span class="star auxiliary">Kình dương (M)</span>, <span class="star strong">Hóa kỵ (V)</span></div>
                <div><span class="star neutral">Quả tú (N)</span>, Nguyệt sát</div>
                <div>Trực phù, Thanh long, Hữu bật</div>
                <div class="palace-bottom">Suy, -THỔ Thân</div>
            </div>

            <!-- ĐIỀN TRẠCH -->
            <div class="palace">
                <div class="palace-coordinates">26 M. Thân</div>
                <div class="palace-age">31-40</div>
                <div class="palace-name">ĐIỀN TRẠCH</div>
                <div class="star average">VŨ KHÚC (B)</div>
                <div class="star auxiliary">THIÊN TƯỚNG (M)</div>
                <div>Vong thần</div>
                <div class="palace-bottom">Bệnh, +KIM Dậu</div>
            </div>

            <!-- SỰ NGHIỆP -->
            <div class="palace">
                <div class="palace-coordinates">K. Dậu</div>
                <div class="palace-age">41-50</div>
                <div class="palace-name">SỰ NGHIỆP</div>
                <div class="star neutral">THÁI DƯƠNG (N)</div>
                <div class="star average">THIÊN LƯƠNG (B)</div>
                <div><span class="star auxiliary">Thiên việt (M)</span>, Địa giải</div>
                <div>Vân tình, Tường tình</div>
                <div>Thái tuế, Tiêu hao</div>
                <div><span class="star weak">Linh tinh (H)</span>, <span class="star auxiliary">Thiên khốc (M)</span></div>
                <div class="palace-bottom">Mùi, Từ, -KIM</div>
            </div>

            <!-- GIAO HỮU -->
            <div class="palace">
                <div class="palace-coordinates">C. Tuất</div>
                <div class="palace-age">51-60</div>
                <div class="palace-name">GIAO HỮU</div>
                <div class="star auxiliary">THẤT SÁT (M)</div>
                <div>Thiều dương, Tướng quân, Thiên quý, Thiên giải, Phan an</div>
                <div><span class="star weak">Địa kiếp</span>, Thiên thương, Địa võng, <span class="star weak">Thiên không (H)</span>, Âm sát, Nguyệt giải</div>
                <div class="palace-bottom">Ngọ, Mão, -THỔ</div>
            </div>

            <!-- THIÊN DI -->
            <div class="palace">
                <div class="palace-coordinates">76 T. Hợi</div>
                <div class="palace-age">61-70</div>
                <div class="palace-name">THIÊN DI</div>
                <div class="star average">THIÊN CƠ (B)</div>
                <div>Phi liệm, Tấu thư</div>
                <div><span class="star weak">Địa không</span>, Vân xương</div>
                <div>Thiên sử, <span class="star strong">Thiên khôi (V)</span></div>
                <div>Tức thần, Đường phù</div>
                <div><span class="star strong">Hóa khoa (V)</span></div>
                <div><span class="star average">Thiên mã (B)</span></div>
                <div>Thiên phúc, Tuế dịch</div>
                <div>Tang môn, Thiên hình, <span class="star weak">Cô thần (H)</span></div>
                <div class="palace-bottom">Tuyệt, -THỦY</div>
            </div>

            <!-- TẬT ÁCH -->
            <div class="palace">
                <div class="palace-coordinates">86 N. Tị</div>
                <div class="palace-age">71-80</div>
                <div class="palace-name">TẬT ÁCH</div>
                <div class="star average">TỬ VI (B)</div>
                <div>Quan phù, Niễn giải</div>
                <div>Thiều âm, Tam thai</div>
                <div><span class="star strong">Thiên hỉ (V)</span>, Thiên thọ</div>
                <div class="palace-bottom">Thai, +THỦY Tị</div>
            </div>

            <!-- TÀI BẠCH -->
            <div class="palace">
                <div class="palace-coordinates">96 Q. Sửu</div>
                <div class="palace-age">81-90</div>
                <div class="palace-name">TÀI BẠCH</div>
                <div>Từ phủ, Hì thần</div>
                <div>Bệnh phủ, <span class="star average">Long tri (B)</span></div>
                <div><span class="star auxiliary">Hỏa tinh (M)</span>, <span class="star average">Phương các (B)</span></div>
                <div><span class="star average">Kiếp sát (B)</span>, <span class="star average">Giải thần (B)</span></div>
                <div class="special-box">Tiệt không</div>
                <div>Phong cáo, <span class="star weak">Hoa cái (H)</span></div>
                <div class="palace-bottom">Dưỡng, -THỔ Thìn</div>
            </div>

            <!-- TỪ NỮ -->
            <div class="palace">
                <div class="palace-coordinates">N. Dần</div>
                <div class="palace-age">91-100</div>
                <div class="palace-name">TỪ NỮ</div>
                <div class="star weak">PHÁ QUÂN (H)</div>
                <div>Bát tọa, Nguyệt đức</div>
                <div>Quốc ấn, Thiên tài</div>
                <div><span class="star strong">Thiên quan (V)</span>, Thiên vu</div>
                <div class="palace-bottom">Dần, Trường sinh, +MỘC Mão</div>
            </div>

            <!-- PHU THÊ -->
            <div class="palace">
                <div class="palace-coordinates">Q. Mão</div>
                <div class="palace-age">101-110</div>
                <div class="palace-name">PHU THÊ</div>
                <div><span class="star auxiliary">Vân khúc</span>, Thiên y</div>
                <div>Tuế phá, <span class="star neutral">Đại hao (N)</span></div>
                <div><span class="star auxiliary">Thiên hư (M)</span>, Thiên điều</div>
                <div>Tai sát</div>
                <div class="special-box">Tiệt không</div>
                <div class="palace-bottom">Sửu, Mộc dục, -MỘC</div>
            </div>

            <!-- HUYNH ĐỆ -->
            <div class="palace">
                <div class="palace-coordinates">G. Thìn</div>
                <div class="palace-age">111-120</div>
                <div class="palace-name">HUYNH ĐỆ</div>
                <div class="star strong">LIÊM TRINH (V)</div>
                <div class="star auxiliary">THIÊN PHỦ (M)</div>
                <div>Long đức, Ân quang</div>
                <div>Phục bình, Thiên la</div>
                <div>Lưu hà, Thiên nguyệt</div>
                <div>Thiên sát</div>
                <div class="special-box">Tuần không</div>
                <div class="palace-bottom">Ti, Quan đới, +THỔ</div>
            </div>

            <!-- Central Info Block -->
            <div class="central-info">
                <h3>THÔNG TIN CHÍNH</h3>
                <div class="info-row">
                    <span class="info-label">Năm:</span>
                    <span class="info-value">Đinh Dậu</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Tháng:</span>
                    <span class="info-value">3 (Giáp Thìn)</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Ngày:</span>
                    <span class="info-value">19</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Giờ:</span>
                    <span class="info-value">Hợi</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Âm Dương:</span>
                    <span class="info-value">Âm Nữ</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Mệnh:</span>
                    <span class="info-value red">SƠN HẠ HÓA</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Cục:</span>
                    <span class="info-value red">HÓA LỤC CỤC</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Thân cư:</span>
                    <span class="info-value">Phu thê</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Mệnh chủ:</span>
                    <span class="info-value">Vũ khúc</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Thân chủ:</span>
                    <span class="info-value">Thiên đồng</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Sao chủ cục:</span>
                    <span class="info-value">Liêm trinh</span>
                </div>
            </div>
        </div>

        <div class="color-legend">
            <div class="legend-item">
                <div class="legend-color kim"></div>
                <span>Kim</span>
            </div>
            <div class="legend-item">
                <div class="legend-color thuy"></div>
                <span>Thủy</span>
            </div>
            <div class="legend-item">
                <div class="legend-color moc"></div>
                <span>Mộc</span>
            </div>
            <div class="legend-item">
                <div class="legend-color hoa"></div>
                <span>Hỏa</span>
            </div>
            <div class="legend-item">
                <div class="legend-color tho"></div>
                <span>Thổ</span>
            </div>
        </div>

        <div class="legend-text">
            M: Nhâm Miếu, V: Thừa Vượng, B: Bình Cung, N: Nhận Địa, H: Lạc Hãm
        </div>

        <!-- Data Loading Section -->
        <div style="margin-top: 30px; text-align: center;">
            <button id="loadMdBtn" style="background: #3498db; color: white; padding: 12px 24px; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; margin: 10px;">
                📁 Tải dữ liệu từ file MD
            </button>
            <button id="loadSampleBtn" style="background: #27ae60; color: white; padding: 12px 24px; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; margin: 10px;">
                🎯 Tải dữ liệu mẫu
            </button>
            <button id="testFileBtn" style="background: #f39c12; color: white; padding: 12px 24px; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; margin: 10px;">
                🔍 Kiểm tra file
            </button>
            <button id="clearBtn" style="background: #e74c3c; color: white; padding: 12px 24px; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; margin: 10px;">
                🗑️ Xóa dữ liệu
            </button>
        </div>

        <div id="status" style="margin: 20px; padding: 15px; border-radius: 8px; text-align: center; display: none;"></div>
    </div>

    <script>
        // Function to show status message
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.style.display = 'block';
            statusDiv.style.background = type === 'error' ? '#f8d7da' : 
                                       type === 'success' ? '#d4edda' : '#d1ecf1';
            statusDiv.style.color = type === 'error' ? '#721c24' : 
                                   type === 'success' ? '#155724' : '#0c5460';
            statusDiv.style.border = `1px solid ${type === 'error' ? '#f5c6cb' : 
                                               type === 'success' ? '#c3e6cb' : '#bee5eb'}`;
            statusDiv.innerHTML = message;
        }

        // Function to parse markdown data
        function parseMarkdownToData(markdownText) {
            const data = {
                cungTuVi: {}
            };
            
            const lines = markdownText.split('\n');
            let currentSection = '';
            let currentCung = '';
            
            for (let line of lines) {
                line = line.trim();
                if (!line) continue;
                
                // Check for main sections
                if (line.startsWith('## ')) {
                    currentCung = line.substring(3).trim();
                    if (!data.cungTuVi[currentCung]) {
                        data.cungTuVi[currentCung] = {
                            diaChi: '',
                            chinhTinh: '',
                            phuTinhTot: '',
                            phuTinhXau: '',
                            phuTinhTrungBinh: '',
                            vongTrangSinh: '',
                            special: '',
                            coordinates: '',
                            ageRange: '',
                            isThan: false // Added for THÂN/N/THỦY
                        };
                    }
                }
                
                // Parse personal info from header
                if (line.includes('ho_ten:')) {
                    data.hoTen = line.split(':')[1]?.trim() || '';
                } else if (line.includes('gioi_tinh:')) {
                    data.gioiTinh = line.split(':')[1]?.trim() || '';
                } else if (line.includes('duong_lich:')) {
                    data.duongLich = line.split(':')[1]?.trim() || '';
                } else if (line.includes('am_lich:')) {
                    data.amLich = line.split(':')[1]?.trim() || '';
                } else if (line.includes('noi_sinh:')) {
                    data.noiSinh = line.split(':')[1]?.trim() || '';
                } else if (line.includes('ban_menh:')) {
                    data.banMenh = line.split(':')[1]?.trim() || '';
                } else if (line.includes('cuc:')) {
                    data.cuc = line.split(':')[1]?.trim() || '';
                } else if (line.includes('am_duong:')) {
                    data.amDuong = line.split(':')[1]?.trim() || '';
                } else if (line.includes('chu_menh:')) {
                    data.chuMenh = line.split(':')[1]?.trim() || '';
                } else if (line.includes('chu_than:')) {
                    data.chuThan = line.split(':')[1]?.trim() || '';
                }
                
                // Parse cung data
                if (currentCung && data.cungTuVi[currentCung]) {
                    const cung = data.cungTuVi[currentCung];
                    
                    if (line.includes('dia_chi:')) {
                        cung.diaChi = line.split(':')[1]?.trim() || '';
                    } else if (line.includes('chinh_tinh:')) {
                        cung.chinhTinh = line.split(':')[1]?.trim() || '';
                    } else if (line.includes('phu_tinh_tot:')) {
                        cung.phuTinhTot = line.split(':')[1]?.trim() || '';
                    } else if (line.includes('phu_tinh_xau:')) {
                        cung.phuTinhXau = line.split(':')[1]?.trim() || '';
                    } else if (line.includes('phu_tinh_trung_binh:')) {
                        cung.phuTinhTrungBinh = line.split(':')[1]?.trim() || '';
                    } else if (line.includes('vong_trang_sinh:')) {
                        cung.vongTrangSinh = line.split(':')[1]?.trim() || '';
                    } else if (line.includes('is_than:')) {
                        cung.isThan = line.split(':')[1]?.trim() === 'true';
                    }
                }
            }
            
            // Set default values for missing fields
            data.nam = data.amLich ? data.amLich.split(' ')[1] || 'N/A' : 'N/A';
            data.thang = data.amLich ? data.amLich.split(' ')[0] || 'N/A' : 'N/A';
            data.ngay = '19'; // Default from am_lich
            data.gio = '14:30'; // Default from duong_lich
            data.saoChuCuc = 'N/A';
            data.thanCu = 'N/A';
            
            return data;
        }

        // Function to display data on the interface
        function displayDataOnInterface(data) {
            if (!data || !data.cungTuVi) {
                showStatus('Không có dữ liệu hợp lệ để hiển thị', 'error');
                return;
            }

            // Update central info
            const centralInfo = document.querySelector('.central-info');
            if (centralInfo) {
                centralInfo.innerHTML = `
                    <h3>THÔNG TIN CHÍNH</h3>
                    <div class="info-row">
                        <span class="info-label">Họ tên:</span>
                        <span class="info-value">${data.hoTen || 'N/A'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Giới tính:</span>
                        <span class="info-value">${data.gioiTinh || 'N/A'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Dương lịch:</span>
                        <span class="info-value">${data.duongLich || 'N/A'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Âm lịch:</span>
                        <span class="info-value">${data.amLich || 'N/A'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Nơi sinh:</span>
                        <span class="info-value">${data.noiSinh || 'N/A'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Bản mệnh:</span>
                        <span class="info-value red">${data.banMenh || 'N/A'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Cục:</span>
                        <span class="info-value red">${data.cuc || 'N/A'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Âm Dương:</span>
                        <span class="info-value">${data.amDuong || 'N/A'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Mệnh chủ:</span>
                        <span class="info-value">${data.chuMenh || 'N/A'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Thân chủ:</span>
                        <span class="info-value">${data.chuThan || 'N/A'}</span>
                    </div>
                `;
            }

            // Update palaces - map Vietnamese cung names to display names
            const cungMapping = {
                'mệnh': 1, 'phụ mẫu': 2, 'phúc đức': 3, 'điền trạch': 4,
                'quan lộc': 5, 'nô bộc': 6, 'thiên di': 7, 'tật ách': 8,
                'tài bạch': 9, 'tử tức': 10, 'phu thê': 11, 'huynh đệ': 12
            };

            const displayNames = {
                'mệnh': 'MỆNH', 'phụ mẫu': 'PHỤ MẪU', 'phúc đức': 'PHÚC ĐỨC', 'điền trạch': 'ĐIỀN TRẠCH',
                'quan lộc': 'SỰ NGHIỆP', 'nô bộc': 'GIAO HỮU', 'thiên di': 'THIÊN DI', 'tật ách': 'TẬT ÁCH',
                'tài bạch': 'TÀI BẠCH', 'tử tức': 'TỬ NỮ', 'phu thê': 'PHU THÊ', 'huynh đệ': 'HUYNH ĐỆ'
            };

            Object.keys(cungMapping).forEach(cungName => {
                const palaceIndex = cungMapping[cungName];
                const palace = document.querySelector(`.palace:nth-child(${palaceIndex})`);
                const cungData = data.cungTuVi[cungName];
                
                if (palace && cungData) {
                    // Update palace content based on parsed data
                    let content = `
                        <div class="palace-coordinates">${cungData.diaChi || 'N/A'}</div>
                        <div class="palace-age">${cungData.isThan ? 'THÂN' : 'N/A'}</div>
                        <div class="palace-name">${displayNames[cungName]}</div>
                    `;
                    
                    if (cungData.chinhTinh) {
                        content += `<div class="star weak">${cungData.chinhTinh}</div>`;
                    }
                    
                    if (cungData.phuTinhTot) {
                        content += `<div>${cungData.phuTinhTot}</div>`;
                    }
                    
                    if (cungData.phuTinhXau) {
                        content += `<div>${cungData.phuTinhXau}</div>`;
                    }
                    
                    if (cungData.phuTinhTrungBinh) {
                        content += `<div>${cungData.phuTinhTrungBinh}</div>`;
                    }
                    
                    content += `<div class="palace-bottom">${cungData.vongTrangSinh || 'N/A'}</div>`;
                    
                    palace.innerHTML = content;
                }
            });

            showStatus('Đã tải dữ liệu thành công!', 'success');
        }

        // Function to load markdown file
        async function loadMarkdownFile() {
            try {
                showStatus('Đang tải file markdown...', 'info');
                
                // Try to load the file with better error handling
                const response = await fetch('sample_gemini_response.md', {
                    method: 'GET',
                    headers: {
                        'Accept': 'text/plain, text/markdown, */*',
                        'Cache-Control': 'no-cache'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status} - ${response.statusText}`);
                }
                
                const markdownText = await response.text();
                console.log('Loaded markdown content:', markdownText.substring(0, 200) + '...');
                
                const parsedData = parseMarkdownToData(markdownText);
                console.log('Parsed data:', parsedData);
                
                // Save to localStorage
                localStorage.setItem('current_tuvi_result', JSON.stringify(parsedData));
                
                // Display on interface
                displayDataOnInterface(parsedData);
                
            } catch (error) {
                console.error('Error loading markdown:', error);
                
                // More detailed error messages
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    showStatus('Lỗi: Không thể kết nối đến file. Hãy đảm bảo file sample_gemini_response.md tồn tại và server đang chạy.', 'error');
                } else if (error.message.includes('HTTP error')) {
                    showStatus(`Lỗi HTTP: ${error.message}`, 'error');
                } else {
                    showStatus(`Lỗi khi tải file: ${error.message}`, 'error');
                }
                
                // Try to provide helpful debugging info
                showStatus('💡 Gợi ý: Hãy kiểm tra console để xem chi tiết lỗi', 'error');
            }
        }

        // Function to load sample data
        function loadSampleData() {
            const sampleData = {
                nam: "Đinh Dậu",
                thang: "3 (Giáp Thìn)",
                ngay: "19",
                gio: "Hợi",
                amDuong: "Âm Nữ",
                banMenh: "SƠN HẠ HÓA",
                cuc: "HÓA LỤC CỤC",
                thanCu: "Phu thê",
                chuMenh: "Vũ khúc",
                chuThan: "Thiên đồng",
                saoChuCuc: "Liêm trinh",
                cungTuVi: {
                    'mệnh': {
                        coordinates: "A. Tý",
                        ageRange: "1-10",
                        diaChi: "Hợi",
                        chinhTinh: "THÁI ÂM (H)",
                        phuTinhTot: "Đài phu, Hòa lộc (B), Thiên trú, Bạch hổ, Quan phủ, Lộc tồn (V), Thiên đức (V)",
                        phuTinhXau: "Đà la (H), Bác sĩ, Phá toái (H), Tả phủ, Chỉ bối, Hàm trì (H), Hồng loan (V), Đầu quân",
                        vongTrangSinh: "Lâm quan",
                        special: "Tuần không",
                        isThan: false
                    }
                    // Add more cung data as needed
                }
            };
            
            localStorage.setItem('current_tuvi_result', JSON.stringify(sampleData));
            displayDataOnInterface(sampleData);
        }

        // Function to test file existence
        async function testFile() {
            try {
                showStatus('Đang kiểm tra file...', 'info');
                
                // Test if file exists
                const response = await fetch('sample_gemini_response.md', { method: 'HEAD' });
                
                if (response.ok) {
                    showStatus(`✅ File tồn tại! Status: ${response.status} - ${response.statusText}`, 'success');
                    
                    // Try to get file info
                    const contentResponse = await fetch('sample_gemini_response.md');
                    const content = await contentResponse.text();
                    const fileSize = content.length;
                    
                    showStatus(`✅ File tồn tại! Kích thước: ${fileSize} ký tự<br>Dòng đầu: ${content.split('\n')[0]}`, 'success');
                    
                } else {
                    showStatus(`❌ File không tồn tại hoặc không thể truy cập. Status: ${response.status}`, 'error');
                }
                
            } catch (error) {
                console.error('Test file error:', error);
                showStatus(`❌ Lỗi khi kiểm tra file: ${error.message}`, 'error');
                
                // Provide debugging tips
                showStatus(`❌ Lỗi khi kiểm tra file: ${error.message}<br><br>💡 Gợi ý: Hãy kiểm tra:<br>1. File sample_gemini_response.md có tồn tại không?<br>2. Server có đang chạy không?<br>3. Console có hiển thị lỗi gì không?`, 'error');
            }
        }

        // Function to clear data
        function clearData() {
            localStorage.removeItem('current_tuvi_result');
            location.reload(); // Reload to show default interface
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Check if there's stored data
            const storedData = localStorage.getItem('current_tuvi_result');
            if (storedData) {
                try {
                    const parsedData = JSON.parse(storedData);
                    displayDataOnInterface(parsedData);
                } catch (e) {
                    console.log('Invalid stored data, using default interface');
                }
            }

            // Add button event listeners
            document.getElementById('loadMdBtn').addEventListener('click', loadMarkdownFile);
            document.getElementById('loadSampleBtn').addEventListener('click', loadSampleData);
            document.getElementById('testFileBtn').addEventListener('click', testFile);
            document.getElementById('clearBtn').addEventListener('click', clearData);
        });
    </script>
</body>
</html>
